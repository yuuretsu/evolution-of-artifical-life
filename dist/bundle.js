(()=>{"use strict";var t={184:function(t,e,n){var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.Genome=void 0;var a=n(571),c=n(439),s=n(812),u=function(t){function e(n,r,o,i,s,u,l,h){var d=t.call(this,n,r,o,i)||this;return d.energy=s,d.genome=u,d.family=l,d.abilities=h,e.amount++,d._narrow=c.randInt(0,8),d.age=0,d.lastAction=new a.Rgba(20,20,20,255),d}return o(e,t),Object.defineProperty(e.prototype,"narrow",{get:function(){return this._narrow},set:function(t){this._narrow=c.fixNumber(0,8,t)},enumerable:!1,configurable:!0}),e.prototype.narrowToCoords=function(){var t=this.x+s.MOORE_NEIGHBOURHOOD[this.narrow][0],e=this.y+s.MOORE_NEIGHBOURHOOD[this.narrow][1];return this.world.fixCoords(t,e)},e.prototype.getForvard=function(){var t,e=this.narrowToCoords();return{block:(t=this.world).get.apply(t,e),coords:e}},e.prototype.moveTo=function(t,e){this.world.swap(this.x,this.y,t,e)},e.prototype.multiplyTo=function(t,n){new e(this.world,t,n,this.color.interpolate(new a.Rgba(255,255,255,255),.25),this.energy/3,this.genome.replication(),this.family.mutateRgb(10),i({},this.abilities)),this.energy/=3},e.prototype.randMove=function(){var t=this.world.fixCoords(this.x+c.randInt(-1,2),this.y+c.randInt(-1,2));this.moveTo.apply(this,t)},e.prototype.onStep=function(){this.energy<1||this.energy>100||this.age>2e3?this.alive=!1:(this.genome.doAction(this),this.energy-=.1,this.age+=1)},e.prototype.onDie=function(){e.amount--},e.amount=0,e}(s.DynamicBlock);e.default=u;var l=function(t){function e(e){var n=t.call(this,e.world,e.x,e.y,e.color.interpolate(new a.Rgba(0,0,0,255),.5))||this;return n.age=0,n}return o(e,t),e.prototype.onStep=function(){this.age>500&&(this.alive=!1),this.color=this.color.interpolate(new a.Rgba(10,10,50,255),.005),this.age++},e}(s.DynamicBlock),h=function(){function t(t){this.length=t,this.genes=[],this._pointer=0}return Object.defineProperty(t.prototype,"pointer",{get:function(){return this._pointer},set:function(t){this._pointer=c.fixNumber(0,this.length,t)},enumerable:!1,configurable:!0}),t.prototype.randGene=function(){return{action:c.randChoice(d),property:Math.random(),branches:[c.randInt(0,this.length),c.randInt(0,this.length),c.randInt(0,this.length),c.randInt(0,this.length)]}},t.prototype.mutateGene=function(t){var e=this;return{action:Math.random()>.9?c.randChoice(d):t.action,property:c.limNumber(0,1,t.property+c.randFloat(-.01,.01)),branches:t.branches.map((function(t){return Math.random()>.9?c.randInt(0,e.length):t}))}},t.prototype.fillRandom=function(t){void 0===t&&(t=0);for(var e=t;e<this.length;e++)this.genes[e]=this.randGene();return this},t.prototype.create=function(t){for(var e=0;e<t.length;e++)this.genes[e]=t[e];return this.fillRandom(t.length),this},t.prototype.fillPlant=function(){for(var t=0;t<this.length;t++)this.genes[t]={action:d[c.randInt(0,3)],property:Math.random(),branches:[c.randInt(0,this.length),c.randInt(0,this.length),c.randInt(0,this.length),c.randInt(0,this.length)]};return this},t.prototype.replication=function(){for(var e=new t(this.length),n=0;n<this.length;n++)e.genes[n]=Math.random()>.995?this.mutateGene(this.genes[n]):this.genes[n];return e},t.prototype.doAction=function(t){t.lastAction=new a.Rgba(20,20,20,255);for(var e=0;e<20;e++){var n=this.genes[this.pointer],r=n.action(t,n.property,n.branches);if(r.goto?this.pointer=r.goto:this.pointer++,r.completed)return}t.color=t.color.interpolate(new a.Rgba(100,100,100,255),.1)},t}();e.Genome=h;var d=[function(t,e,n){return{completed:!1,goto:0}},function(t,e,n){return t.energy+=.5*Math.pow(t.abilities.photo,2),t.abilities.photo=Math.min(1,t.abilities.photo+.01),t.abilities.attack=Math.max(0,t.abilities.attack-.01),t.color=t.color.interpolate(new a.Rgba(0,255,0,255),.01),t.lastAction=new a.Rgba(0,255,0,255),{completed:!0}},function(t,e,n){return e>.5?t.narrow++:t.narrow--,{completed:!1}},function(t,e,n){var r=t.getForvard();return!r.block&&t.age>2&&(t.multiplyTo.apply(t,r.coords),t.lastAction=new a.Rgba(0,0,255,255)),{completed:!0}},function(t,e,n){t.color=t.color.interpolate(new a.Rgba(0,0,255,255),.005);var r=t.getForvard();if(r.block instanceof u&&r.block.energy<t.energy){var o=(r.block.energy+t.energy)/2;t.energy=o,r.block.energy=o,t.lastAction=new a.Rgba(0,100,255,255)}return{completed:!0}},function(t,e,n){var r=t.getForvard();return r.block instanceof u?r.block.family.difference(t.color)<e?{completed:!1,goto:n[0]}:{completed:!1,goto:n[1]}:r.block instanceof l?{completed:!1,goto:n[2]}:{completed:!1,goto:n[3]}},function(t,e,n){return t.energy/100<e?{completed:!1,goto:n[0]}:{completed:!1,goto:n[1]}},function(t,e,n){var r=t.getForvard();return r.block instanceof l&&r.block.age>2&&(r.block.alive=!1,t.lastAction=new a.Rgba(255,255,0,255)),{completed:!0}},function(t,e,n){var r=t.getForvard();return r.block||t.moveTo.apply(t,r.coords),t.lastAction=new a.Rgba(255,255,255,255),{completed:!0}},function(t,e,n){t.energy-=.1,t.color=t.color.interpolate(new a.Rgba(255,0,0,255),.01),t.abilities.attack=Math.min(1,t.abilities.attack+.01),t.abilities.photo=Math.max(0,t.abilities.photo-.01);var r=t.getForvard();if(r.block instanceof u){var o=r.block.energy/2*Math.pow(t.abilities.attack,2);r.block.energy-=r.block.energy/2,t.energy+=o,t.lastAction=new a.Rgba(255,0,0,255)}return{completed:!0}}]},140:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(439),o=function(){function t(t,e){this.width=t,this.height=e,this.cells=[];for(var n=0;n<t;n++)this.cells[n]=[]}return t.prototype.get=function(t,e){return this.cells[t][e]},t.prototype.set=function(t,e,n){this.cells[t][e]=n},t.prototype.remove=function(t,e){delete this.cells[t][e]},t.prototype.swap=function(t,e,n,r){var o=this.get(t,e),i=this.get(n,r);this.set(t,e,i),this.set(n,r,o)},t.prototype.fixCoords=function(t,e){return[r.fixNumber(0,this.width,t),r.fixNumber(0,this.height,e)]},t.prototype.randCoords=function(){return[r.randInt(0,this.width),r.randInt(0,this.height)]},t.prototype.randEmpty=function(){var t;do{t=this.randCoords()}while(this.get.apply(this,t));return t},t}();e.default=o},571:function(t,e,n){var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.PixelsData=e.Canvas=e.Rgba=void 0;var i=n(439),a=function(){function t(t,e,n,r){this.red=t,this.green=e,this.blue=n,this.alpha=r}return t.randRgb=function(){return new t(i.randInt(0,256),i.randInt(0,256),i.randInt(0,256),255)},t.prototype.interpolate=function(e,n){return new t(i.interpolate(this.red,e.red,n),i.interpolate(this.green,e.green,n),i.interpolate(this.blue,e.blue,n),i.interpolate(this.alpha,e.alpha,n))},t.prototype.normalise=function(){return new t(i.limNumber(0,255,this.red),i.limNumber(0,255,this.green),i.limNumber(0,255,this.blue),i.limNumber(0,255,this.alpha))},t.prototype.mutateRgb=function(e){return new t(this.red+i.randFloat(-e,e),this.green+i.randFloat(-e,e),this.blue+i.randFloat(-e,e),this.alpha).normalise()},t.prototype.difference=function(e){return(Math.abs(this.red-e.red)+Math.abs(this.green-e.green)+Math.abs(this.blue-e.blue)+Math.abs(this.alpha-e.alpha))/t.MAX_DIF},t.MAX_DIF=1020,t}();e.Rgba=a;var c=function(t,e,n){this.node=n||document.createElement("canvas"),this.node.width=t,this.node.height=e,this.ctx=this.node.getContext("2d")};e.Canvas=c;var s=function(t){function e(e,n,r){var o=t.call(this,e,n,r)||this;return o.data=o.ctx.getImageData(0,0,o.node.width,o.node.height),o}return o(e,t),e.prototype.setPixel=function(t,e,n){var r=4*(e*this.data.width+t);this.data.data[r]=n.red,this.data.data[r+1]=n.green,this.data.data[r+2]=n.blue,this.data.data[r+3]=n.alpha},e.prototype.update=function(){return this.ctx.putImageData(this.data,0,0),this},e}(c);e.PixelsData=s},439:function(t,e){var n=this&&this.__generator||function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};function r(t,e){return Math.random()*(e-t)+t}function o(t,e){return Math.floor(r(t,e))}Object.defineProperty(e,"__esModule",{value:!0}),e.interpolate=e.limNumber=e.normalizeNumber=e.fixNumber=e.randChoice=e.randInt=e.randFloat=e.range=void 0,e.range=function(t,e){return n(this,(function(n){switch(n.label){case 0:return t<e?[4,t++]:[3,2];case 1:return n.sent(),[3,0];case 2:return[2]}}))},e.randFloat=r,e.randInt=o,e.randChoice=function(t){return t[o(0,t.length)]},e.fixNumber=function(t,e,n){return n>=t?n%e:e- -n%e},e.normalizeNumber=function(t,e,n){return(n-t)/(e-t)},e.limNumber=function(t,e,n){return Math.max(Math.min(n,e),t)},e.interpolate=function(t,e,n){return t+(e-t)*n}},812:function(t,e,n){var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.World=e.DynamicBlock=e.Block=e.MOORE_NEIGHBOURHOOD=void 0;var i=n(571),a=n(140),c=n(439);e.MOORE_NEIGHBOURHOOD=[[-1,-1],[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0]];var s=function(t,e,n,r){this.world=t,this.x=e,this.y=n,this.color=r,t.set(e,n,this)};e.Block=s;var u=function(t){function e(e,n,r,o){var i=t.call(this,e,n,r,o)||this;return e.assign(i),i.alive=!0,i}return o(e,t),e.prototype.onStep=function(){},e.prototype.onDie=function(){},e}(s);e.DynamicBlock=u;var l=function(t){function e(e,n,r,o){var a=t.call(this,e,n)||this;return a.width=e,a.height=n,a.img=new i.Canvas(e*r,n*r,o),a.img.ctx.imageSmoothingEnabled=!1,a.dynamic={a:{},b:{}},a.age=0,a}return o(e,t),e.prototype.set=function(e,n,r){t.prototype.set.call(this,e,n,r),r&&(r.x=e,r.y=n)},e.prototype.drawLayer=function(t){this.img.ctx.drawImage(t,0,0,this.img.node.width,this.img.node.height)},e.prototype.clearImage=function(){this.img.ctx.clearRect(0,0,this.img.node.width,this.img.node.height)},e.prototype.visualize=function(t){for(var e=new i.PixelsData(this.width,this.height),n=0;n<this.width;n++)for(var r=0;r<this.height;r++){var o=t(this.get(n,r),n,r);o&&e.setPixel(n,r,o)}this.drawLayer(e.update().node)},e.prototype.assign=function(t){var e;do{e=c.randInt(0,this.width*this.height*1e3)}while(this.dynamic.a[e]);this.dynamic.a[e]=t},e.prototype.init=function(){this.dynamic.b=this.dynamic.a},e.prototype.step=function(){for(var t in this.dynamic.a={},this.dynamic.b){var e=this.dynamic.b[t];e.alive?(e.onStep(),this.assign(e)):(this.set(e.x,e.y,void 0),e.onDie())}this.dynamic.b=this.dynamic.a,this.age++},e}(a.default);e.World=l},519:function(t,e,n){var r=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,c=i.length;a<c;a++,o++)r[o]=i[a];return r};Object.defineProperty(e,"__esModule",{value:!0});var o,i=n(184),a=n(571),c=n(439),s=n(812);function u(){document.querySelector(".wrapper").style.maxHeight=window.innerHeight+"px"}function l(){i.default.amount=0,o=new s.World(parseInt(document.querySelector("#input-width").value),parseInt(document.querySelector("#input-height").value),parseInt(document.querySelector("#input-pixel").value),document.querySelector("#img"));for(var t=parseInt(document.querySelector("#input-bots").value),e=0;e<Math.min(o.width*o.height,t);e++)new(i.default.bind.apply(i.default,r([void 0,o],o.randEmpty(),[new a.Rgba(100,100,100,255),100,new i.Genome(64).fillRandom(),a.Rgba.randRgb(),{photo:.5,attack:.5}])));o.init()}function h(t){return t instanceof s.Block?t.color:null}function d(t){return t instanceof i.default?new a.Rgba(20,20,100,255).interpolate(new a.Rgba(255,255,0,255),t.energy/100):null}function p(t){return t instanceof i.default?new a.Rgba(255*c.normalizeNumber(.5,1,t.abilities.attack),255*c.normalizeNumber(.5,1,t.abilities.photo),50,255):null}function f(t){return t instanceof i.default?t.family:null}function g(t){return t instanceof i.default?t.lastAction:null}function m(t,e,n){switch(e){case"normal":t.clearImage(),t.visualize(h);break;case"energy":t.clearImage(),t.visualize(d);break;case"families":t.clearImage(),t.visualize(f);break;case"abilities":t.clearImage(),t.visualize(p);break;case"last-action":t.clearImage(),t.visualize(g)}n&&t.drawLayer(function(t){for(var e=new a.PixelsData(3*t.width,3*t.height),n=0;n<t.width;n++)for(var o=0;o<t.height;o++){var c=t.get(n,o);if(c instanceof i.default){var u=[3*c.x+1+s.MOORE_NEIGHBOURHOOD[c.narrow][0],3*c.y+1+s.MOORE_NEIGHBOURHOOD[c.narrow][1]];e.setPixel.apply(e,r(u,[new a.Rgba(0,0,0,255)]))}}return e.update(),e.node}(t))}window.addEventListener("resize",u),u(),window.addEventListener("load",(function(){var t,e,n,r,a;null===(t=document.querySelector("#input-width"))||void 0===t||t.addEventListener("change",(function(t){var e=t.target;e.value=c.limNumber(1,2048,parseInt(e.value)).toString()})),null===(e=document.querySelector("#input-height"))||void 0===e||e.addEventListener("change",(function(t){var e=t.target;e.value=c.limNumber(1,2048,parseInt(e.value)).toString()})),null===(n=document.querySelector("#input-pixel"))||void 0===n||n.addEventListener("change",(function(t){var e=t.target;e.value=c.limNumber(1,50,parseInt(e.value)).toString()}));var s,u,h,d,p=document.querySelector("#btn-menu"),f=document.querySelector("#img-container"),g=document.querySelector("#img");p.addEventListener("change",(function(){var t,e;p.checked?(f.classList.add("img-wrapper--menu-opened"),null===(t=document.querySelector("#menu"))||void 0===t||t.classList.add("wrapper__menu--menu-opened")):(f.classList.remove("img-wrapper--menu-opened"),null===(e=document.querySelector("#menu"))||void 0===e||e.classList.remove("wrapper__menu--menu-opened"))}));var y=0,v=0,b=!1;function w(t){t instanceof TouchEvent?(h=t.touches[0].clientX-y,d=t.touches[0].clientY-v):(h=t.clientX-y,d=t.clientY-v),t.target===g&&(b=!0)}function _(){h=s,d=u,b=!1}function O(t){b&&(t.preventDefault(),t instanceof TouchEvent?(s=t.touches[0].clientX-h,u=t.touches[0].clientY-d):(s=t.clientX-h,u=t.clientY-d),y=s,v=u,g.style.transform="translate3d("+s+"px, "+u+"px, 0)")}f.addEventListener("touchstart",w,!1),f.addEventListener("touchend",_,!1),f.addEventListener("touchmove",O,!1),f.addEventListener("mousedown",w,!1),f.addEventListener("mouseup",_,!1),f.addEventListener("mousemove",O,!1);var x=document.querySelector("#amount"),k=document.querySelector("#fps"),I=document.querySelector("#frame-number"),R=document.querySelector("#view-mode"),M=document.querySelector("#chbx-narrows"),E=document.querySelector("#chbx-upd-img");null===(r=document.querySelector("#btn-start"))||void 0===r||r.addEventListener("click",l),null===(a=document.querySelector("#btn-step"))||void 0===a||a.addEventListener("click",(function(){o.step(),m(o,R.value,M.checked)})),document.querySelector("#btn-pause").addEventListener("click",(function(t){switch(D){case!0:D=!1;break;case!1:D=!0}})),l();var S=Date.now(),N=0,D=!1;setInterval((function(){Date.now()-S>1e3&&(k.innerHTML=N.toFixed(0),N=0,S=Date.now()),N++,D||o.step(),E.checked&&m(o,R.value,M.checked),x.innerHTML=i.default.amount.toString(),I.innerHTML=(o.age/1e3).toFixed(1)+" тыс. кадров"}))}))}},e={};!function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,n),o.exports}(519)})();
//# sourceMappingURL=bundle.js.map